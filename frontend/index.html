<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Worldline Sim</title>
    <link rel="stylesheet" href="css/app.css" />
  </head>
  <body>
    <div class="app">
      <header class="hero">
        <div>
          <p class="eyebrow" data-i18n="hero.eyebrow">Worldline Simulation</p>
          <div class="hero-title-row">
            <h1 data-i18n="hero.title">Worldline Sim</h1>
            <span id="appVersionBadge" class="app-version-badge">V1.0</span>
          </div>
          <p class="subtitle" data-i18n="hero.subtitle">
            Create a world, let it evolve, and track each tick as a structured report.
          </p>
        </div>
        <div class="hero-right">
          <div class="hero-status">
            <div class="status-card">
              <span data-i18n="status.session">Session</span>
              <strong id="sessionId">Not created</strong>
            </div>
            <div class="status-card">
              <span data-i18n="status.runner">Runner</span>
              <strong id="runnerState">idle</strong>
            </div>
            <div class="status-card">
              <span data-i18n="status.websocket">WebSocket</span>
              <strong id="connectionState">disconnected</strong>
            </div>
          </div>
          <div class="hero-actions">
            <button id="openSettingsTab" class="ghost tab-button" data-i18n="settings.open_tab">
              Settings
            </button>
          </div>
        </div>
      </header>

      <section id="mainLayout" class="layout">
        <aside class="panel">
          <details class="panel-section" open>
            <summary class="panel-section-summary">
              <h2 data-i18n="runner.section">Runner Controls</h2>
            </summary>
            <div class="panel-section-body">
              <div class="row controls-row row-3">
                <button id="startSession" class="accent runner-control" data-i18n="runner.start">
                  Start
                </button>
                <button id="pauseSession" class="ghost runner-control" data-i18n="runner.pause">
                  Pause
                </button>
                <button id="resumeSession" class="ghost runner-control" data-i18n="runner.resume">
                  Resume
                </button>
              </div>
              <p class="hint" data-i18n="runner.hint">
                The runner generates a report, then waits the configured delay before the next tick.
              </p>
            </div>
          </details>

          <details class="panel-section" open>
            <summary class="panel-section-summary">
              <h2 data-i18n="setup.section">Session Setup</h2>
            </summary>
            <div class="panel-section-body">
              <label>
                <span data-i18n="setup.title">Title</span>
                <input
                  id="sessionTitle"
                  type="text"
                  data-i18n-placeholder="setup.title_placeholder"
                />
              </label>
              <label>
                <span data-i18n="setup.world_preset">World preset</span>
                <textarea
                  id="worldPreset"
                  rows="6"
                  data-i18n-placeholder="setup.world_preset_placeholder"
                ></textarea>
              </label>
              <div class="row row-2">
                <label>
                  <span data-i18n="setup.initial_time">Initial Time</span>
                  <input
                    id="initialTime"
                    type="text"
                    data-i18n-placeholder="setup.initial_time_placeholder"
                  />
                </label>
                <label>
                  <span data-i18n="setup.delay_sec">Delay (sec)</span>
                  <input id="postDelay" type="number" min="1" max="3600" value="5" />
                </label>
              </div>
              <div class="row row-2">
                <label>
                  <span data-i18n="setup.interval_value">Interval Value</span>
                  <input id="timeStepValue" type="number" min="1" max="1200" value="1" />
                </label>
                <label>
                  <span data-i18n="setup.interval_unit">Interval Unit</span>
                  <select id="timeStepUnit">
                    <option value="day">day</option>
                    <option value="week">week</option>
                    <option value="month" selected>month</option>
                    <option value="year">year</option>
                  </select>
                </label>
              </div>
              <input id="tickLabel" type="hidden" />
              <button id="createSession" class="primary" data-i18n="setup.create_session">
                Create Session
              </button>
            </div>
          </details>

          <details class="panel-section" open>
            <summary class="panel-section-summary">
              <h2 data-i18n="provider.section">Provider</h2>
            </summary>
            <div class="panel-section-body">
              <label>
                <span data-i18n="provider.provider">Provider</span>
                <select id="providerSelect">
                  <option value="openai">OpenAI</option>
                  <option value="ollama">Ollama</option>
                  <option value="deepseek">DeepSeek</option>
                  <option value="gemini">Gemini</option>
                </select>
              </label>
              <label>
                <span data-i18n="provider.api_key">API key</span>
                <input
                  id="apiKey"
                  type="password"
                  data-i18n-placeholder="provider.api_key_placeholder"
                />
              </label>
              <label class="inline-option">
                <input id="rememberApiKey" type="checkbox" />
                <span data-i18n="provider.remember_key">Remember API key on this device</span>
              </label>
              <p class="hint" data-i18n="provider.remember_hint">
                Stored in this browser only, not tracked by git.
              </p>
              <label>
                <span data-i18n="provider.base_url">Base URL</span>
                <input
                  id="baseUrl"
                  type="text"
                  data-i18n-placeholder="provider.base_url_placeholder"
                />
              </label>
              <button id="loadModels" class="ghost" data-i18n="provider.load_models">
                Load Models
              </button>
              <label>
                <span data-i18n="provider.model">Model</span>
                <select id="modelSelect"></select>
              </label>
            </div>
          </details>

          <details class="panel-section" open>
            <summary class="panel-section-summary">
              <h2 data-i18n="setup.history_section">History Sessions</h2>
            </summary>
            <div class="panel-section-body">
              <div class="row align-end row-2">
                <label>
                  <span data-i18n="setup.load_session_id">Session ID</span>
                  <input
                    id="loadSessionId"
                    type="text"
                    data-i18n-placeholder="setup.load_session_id_placeholder"
                  />
                </label>
                <button id="loadSession" class="ghost" data-i18n="setup.load_session">
                  Load Session
                </button>
              </div>
              <div class="row controls-row">
                <button
                  id="refreshSessionHistory"
                  class="ghost"
                  data-i18n="setup.refresh_history"
                >
                  Refresh History
                </button>
              </div>
              <div id="sessionHistoryList" class="session-history-list"></div>
            </div>
          </details>

          <details class="panel-section" open>
            <summary class="panel-section-summary">
              <h2 data-i18n="setup.language">Interface Language</h2>
            </summary>
            <div class="panel-section-body">
              <label>
                <span data-i18n="setup.language">Interface Language</span>
                <select id="languageSelect"></select>
              </label>
            </div>
          </details>
        </aside>

        <main class="timeline">
          <div class="timeline-header">
            <h2 data-i18n="timeline.section">Timeline</h2>
            <div class="row timeline-actions">
              <button id="forkBranch" class="ghost" data-i18n="timeline.fork_branch">
                Fork Branch
              </button>
              <button id="deleteLast" class="ghost" data-i18n="timeline.delete_last">
                Delete Last
              </button>
              <button id="refreshTimeline" class="ghost" data-i18n="timeline.refresh">Refresh</button>
            </div>
          </div>
          <div id="branchTabs" class="branch-tabs"></div>
          <div id="timelineList" class="timeline-list"></div>
          <div class="intervention-box">
            <label>
              <span data-i18n="timeline.intervention">Intervention</span>
              <textarea
                id="interventionInput"
                rows="3"
                data-i18n-placeholder="timeline.intervention_placeholder"
              ></textarea>
            </label>
            <button id="sendIntervention" class="primary" data-i18n="timeline.send_intervention">
              Send Intervention
            </button>
          </div>
        </main>

        <aside class="panel side-panel">
          <details class="panel-section" open>
            <summary class="panel-section-summary">
              <h2 data-i18n="sidebar.key_events">Key Events Timeline</h2>
            </summary>
            <div class="panel-section-body">
              <div id="keyEventsList" class="key-events-list"></div>
            </div>
          </details>
          <details class="panel-section" open>
            <summary class="panel-section-summary">
              <h2 data-i18n="log.section">System Log</h2>
            </summary>
            <div class="panel-section-body">
              <div id="logList" class="log-list"></div>
            </div>
          </details>
        </aside>
      </section>

      <section id="settingsPage" class="settings-page is-hidden">
        <div class="settings-page-header">
          <h2 data-i18n="settings.section">Settings</h2>
          <button id="closeSettingsTab" class="ghost" data-i18n="settings.back">Back</button>
        </div>
        <p class="hint" data-i18n="settings.hint">
          Load and patch runtime settings without restart.
        </p>
        <div class="row controls-row row-2">
          <button id="loadRuntimeSettings" class="ghost" data-i18n="settings.load">
            Load Settings
          </button>
          <button id="applyRuntimeSettings" class="accent" data-i18n="settings.apply">
            Apply Settings
          </button>
        </div>
        <div id="runtimeSettingsForm" class="settings-form-grid"></div>
        <p class="settings-copyright">
          <span data-i18n="settings.copyright">© Syoushiro 版权所有，祝你们玩得开心。</span>
          <span id="appVersionFooter" class="settings-version-tag">V1.0</span>
        </p>
      </section>
    </div>

    <script type="module" src="js/app.js"></script>
  </body>
</html>
